<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>QMap Permalink - Interactive Map</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@8.2.0/ol.css" type="text/css">
<script src="https://cdn.jsdelivr.net/npm/ol@8.2.0/dist/ol.js"></script>
<style>
body { font-family: Arial, sans-serif; margin: 10px; background: #f8f9fa; }
#map { width: 100%; height: 400px; border: 2px solid #ddd; border-radius: 8px; margin: 10px 0; }
.info-section { margin: 15px 0; padding: 15px; background: white; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
.link-section { margin: 15px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px; background: white; }
.link-title { font-weight: bold; color: #333; margin-bottom: 5px; }
.map-title { font-weight: bold; color: #2c5aa0; margin-bottom: 10px; font-size: 18px; }
a { color: #1a73e8; text-decoration: none; word-break: break-all; }
a:hover { text-decoration: underline; }
.coordinates { font-family: monospace; background: #e9ecef; padding: 5px; border-radius: 3px; }
.error-message { color: #d32f2f; background: #ffebee; padding: 10px; border-radius: 5px; border: 1px solid #f8bbd9; }
</style>
</head>
<body>
<h2>ğŸ—ºï¸ QMap Permalink - Interactive Map View</h2>
<div class="info-section">
<div class="map-title">ğŸ“ QGISãƒãƒƒãƒ—ãƒ“ãƒ¥ãƒ¼å†ç¾</div>
<p>QGISã®ç¾åœ¨ã®åœ°å›³è¡¨ç¤ºã‚’OpenLayersã§å†ç¾ã—ã¦ã„ã¾ã™ã€‚åŒã˜ä½ç½®ãƒ»ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
</div>


<div class="info-section">
    <div class="map-title">ğŸ“Š QGISãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±</div>
    <div class="coordinates">
        <strong>ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°:</strong> 7 | 
        <strong>ãƒ™ã‚¯ã‚¿ãƒ¼:</strong> æœ‰ | 
        <strong>ãƒ©ã‚¹ã‚¿ãƒ¼:</strong> æœ‰
    </div>
    <details style="margin-top: 10px;">
        <summary style="cursor: pointer; font-weight: bold;">ğŸ“‹ è¡¨ç¤ºä¸­ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ä¸€è¦§</summary>
        <ul style="margin: 10px 0; padding-left: 20px;">
<li><strong>DM_C</strong> (Vector)</li><li><strong>DM_1</strong> (Vector)</li><li><strong>DM_3</strong> (Vector)</li><li><strong>è¡Œæ”¿åŒºåŸŸ</strong> (Vector)</li><li><strong>éƒ½é“åºœçœŒå</strong> (Vector)</li><li><strong>å¸‚åŒºç”ºæ‘å</strong> (Vector)</li><li><strong>Google Maps</strong> (Raster)</li></ul></details></div>

<div class="info-section">
    <div class="map-title">ğŸ“ QGISãƒãƒƒãƒ—ç¯„å›²</div>
    <div class="coordinates">
        <strong>ç¯„å›²:</strong> X: 15553551.47 - 15562340.50, 
        Y: 4255438.78 - 4258935.25<br>
        <strong>å›è»¢:</strong> 0.00Â° | 
        <strong>å¹…Ã—é«˜:</strong> 8789 Ã— 3496
    </div>
</div>

<div class="info-section">
    <div class="coordinates">
        <strong>ãƒ–ãƒ©ã‚¦ã‚¶è¡¨ç¤ºåº§æ¨™:</strong> 35.683709, 139.759407 | 
        <strong>ã‚ºãƒ¼ãƒ :</strong> N/A | 
        <strong>ã‚¹ã‚±ãƒ¼ãƒ«:</strong> 1:21,280 | 
        <strong>åº§æ¨™ç³»:</strong> EPSG:3857
    </div>
</div>

<div id="map"></div>


<script>
// OpenLayersãƒãƒƒãƒ—ã®åˆæœŸåŒ–ï¼ˆQGISãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ã‚’è€ƒæ…®ï¼‰
const map = new ol.Map({
    target: 'map',
    layers: [
        // OpenStreetMap ãƒ™ãƒ¼ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼
        new ol.layer.Tile({
            source: new ol.source.OSM(),
            opacity: 0.6
        }),
        // åœ°ç†é™¢åœ°å›³ï¼ˆæ—¥æœ¬ã®è©³ç´°åœ°å›³ï¼‰
        new ol.layer.Tile({
            source: new ol.source.XYZ({
                url: 'https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png',
                attributions: '&copy; <a href="https://maps.gsi.go.jp/development/ichiran.html">å›½åœŸåœ°ç†é™¢</a>',
                maxZoom: 18
            }),
            opacity: 0.8
        })
    ],
    view: new ol.View({
        center: ol.proj.fromLonLat([139.75940667292454, 35.683708808647665]),
        zoom: None
    })
});

// QGISãƒãƒƒãƒ—ç¯„å›²ã®è¡¨ç¤º
const qgisExtentInfo = {"xmin": 15553551.467931878, "ymin": 4255438.780619375, "xmax": 15562340.500868123, "ymax": 4258935.250480624, "center_x": 15557945.9844, "center_y": 4257187.01555, "width": 8789.032936245203, "height": 3496.469861248508, "crs": "EPSG:3857", "scale": 21280.199999988385, "rotation": 0.0};
let extentFeatures = [];

// ä¸­å¿ƒç‚¹ã«ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
const marker = new ol.Feature({
    geometry: new ol.geom.Point(ol.proj.fromLonLat([139.75940667292454, 35.683708808647665]))
});

const markerStyle = new ol.style.Style({
    image: new ol.style.Circle({
        radius: 10,
        fill: new ol.style.Fill({color: '#ff4444'}),
        stroke: new ol.style.Stroke({color: '#ffffff', width: 3})
    }),
    text: new ol.style.Text({
        text: 'QGISä¸­å¿ƒ',
        font: '12px Arial',
        fill: new ol.style.Fill({color: '#000'}),
        offsetY: 20,
        backgroundFill: new ol.style.Fill({color: 'rgba(255,255,255,0.8)'})
    })
});

marker.setStyle(markerStyle);
extentFeatures.push(marker);

// QGISã®è¡¨ç¤ºç¯„å›²ãŒã‚ã‚Œã°ç¯„å›²æ ã‚’è¡¨ç¤º
if (qgisExtentInfo && qgisExtentInfo.xmin !== undefined) {
    // WGS84åº§æ¨™ã§ã®ç¯„å›²ã‚’è¨ˆç®—ï¼ˆç°¡æ˜“å¤‰æ›ï¼‰
    const extentGeometry = new ol.geom.Polygon([[
        ol.proj.fromLonLat([qgisExtentInfo.xmin, qgisExtentInfo.ymin]),
        ol.proj.fromLonLat([qgisExtentInfo.xmax, qgisExtentInfo.ymin]),
        ol.proj.fromLonLat([qgisExtentInfo.xmax, qgisExtentInfo.ymax]),
        ol.proj.fromLonLat([qgisExtentInfo.xmin, qgisExtentInfo.ymax]),
        ol.proj.fromLonLat([qgisExtentInfo.xmin, qgisExtentInfo.ymin])
    ]]);
    
    const extentFeature = new ol.Feature({
        geometry: extentGeometry
    });
    
    extentFeature.setStyle(new ol.style.Style({
        stroke: new ol.style.Stroke({
            color: '#00aa00',
            width: 3,
            lineDash: [10, 5]
        }),
        fill: new ol.style.Fill({
            color: 'rgba(0, 170, 0, 0.1)'
        })
    }));
    
    extentFeatures.push(extentFeature);
}

const overlayLayer = new ol.layer.Vector({
    source: new ol.source.Vector({
        features: extentFeatures
    })
});

map.addLayer(overlayLayer);

// ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã§åº§æ¨™ã‚’è¡¨ç¤º
map.on('click', function(event) {
    const coordinate = ol.proj.toLonLat(event.coordinate);
    alert('ã‚¯ãƒªãƒƒã‚¯ä½ç½®: ' + coordinate[1].toFixed(6) + ', ' + coordinate[0].toFixed(6));
});

console.log('QMap Permalink OpenLayers Map initialized at: ' + 35.683708808647665 + ', ' + 139.75940667292454);
</script>


<div class="info-section">
<div class="map-title">ğŸ”— å¤–éƒ¨ãƒãƒƒãƒ—ã‚µãƒ¼ãƒ“ã‚¹</div>
<p>åŒã˜ä½ç½®ã‚’ä»–ã®ãƒãƒƒãƒ—ã‚µãƒ¼ãƒ“ã‚¹ã§ã‚‚ç¢ºèªã§ãã¾ã™ï¼š</p>
<div class="link-section">
<div class="link-title">ğŸ—ºï¸ Google Maps ã§è¡¨ç¤º</div>
<a href="https://www.google.co.jp/maps/@35.683709,139.759407,14.91z" target="_blank" rel="noopener noreferrer">https://www.google.co.jp/maps/@35.683709,139.759407,14.91z</a>
</div>
<div class="link-section">
<div class="link-title">ğŸŒ Google Earth ã§è¡¨ç¤º</div>
<a href="https://earth.google.com/web/@35.683709,139.759407,37.30396321a,217885.59542668d,1y,0h,0t,0r" target="_blank" rel="noopener noreferrer">https://earth.google.com/web/@35.683709,139.759407,37.30396321a,217885.59542668d,1y,0h,0t,0r</a>
</div>
</div>
<hr>
<div class="info-section">
<p><strong>ğŸ“¡ QMap Permalink v1.9.18</strong></p>
<p>ã“ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒƒãƒ—ã¯QGISãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã€ŒQMap Permalinkã€ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚</p>
<p>ãƒãƒƒãƒ—ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦åº§æ¨™ã‚’ç¢ºèªã—ãŸã‚Šã€ã‚ºãƒ¼ãƒ ãƒ»ãƒ‘ãƒ³ã§å‘¨è¾ºã‚’æ¢ç´¢ã§ãã¾ã™ã€‚</p>
</div>
</body>
</html>